
## Frontend/JS server endpoints

### POST /v2/url/:appID
Request
```json
{
  "inapp_data": "app_context",
  "sharelink_info": {
    "redirect_url": "rrr",
    "download_title": "some title",
    "download_msg": "some msg"
  },
  "is_short": true,
  "sdk_info": "sdk version",
  "sender_id": "sender identity, uniqueID or phone number,etc",
  "channels": ["channel_x", "channel_y", "channel_z"]
}
```
If succeeded, returns HTTP 200 OK code and response:
```json
{
  "url": "url generated by js server",
}
```

If is_short is true, the url is:
```
http://fds.so/d/<appID>/<short_token>
```
Otherwise, the url is a long one like:
```
http://fds.so/d/<appID>?inapp_data=ddd&sender_id=sss&channels=x,y,z&download_title=ttt&download_msg=mmm&redirect_url=rrr
```

### GET /v2/url/:appID/:shortSeg

GET Parameters (for tracking):

`?receiver_info={unique_id:ddd,other_info:...}
&tracking=install/open`

Extract in-app data based on <shortSeg>.

If succeeded, returns HTTP 200 OK code and response:
```json
{
  "inapp_data": "app_context"
}
```

### GET /d/:appID with parameter:
`inapp_data=ddd&sender_id=sss&channels=x,y,z&download_title=ttt&download_msg=mmm&redirect_url=rrr`
 
### GET /d/:appID/:token
 
 Response:
 
- html page: instructions to users
- js script: used to launch app on device, or launch app store to download app
- app info: required by js script
- cookieID: required by js script

At the same time, this endpoint will create a cookie for each client, named DSCOOKIE, valued cookieID: DSCOOKIE=cookieID.

ShareLinkFront first send a request to AppCookieDevice to get deviceID, by accessing /appcookiedevice/:appID/:cookieID, if deviceID is not empty, a installed flag will be returned together with js code.

Then send a request to match service before returning the above content.

PUT /matches/:appID/:cookieID

With json body:
```json
{
  "sender_info": {
    "sender_id": "sender identity",
    "channels": ["x","y","z"],
    "sdk_info": "android1.3.1",
  },
  "inapp_data": "ccc",
  "client_ip": "ip of client",
  "client_ua": "user-agent of client"
}
```

### /binddevicetocookie/:unique_id
With DSCOOKIE=cookieID in cookie. ios9 only, for 100% match.

extracts the cookieID and forms a call to cookies service:

PUT /cookies/unique_id, with json body:
```json
{
  "cookie_id": "cookieID",
}
```

### POST /inappdata/:appID

request
```go
{
	IsNewUser bool `json:"is_newuser"`
	//Below fields only possible to be sent when it is a old user
	ClickID    string `json:"click_id"`
	DeeplinkID string `json:"deeplink_id"`
	ShortSeg   string `json:"short_seg"`

	//Below fields should be keep identical as match.MatchRequestReceiverInfo
	UniqueID       string `json:"unique_id"`
	AppVersionName string `json:"app_version_name"`
	//For android version code
	AppVersionCode int `json:"app_version_code"`
	//For IOS build
	AppVersionBuild  string `json:"app_version_build"`
	SDKInfo          string `json:"sdk_info"`
	ISWifiConnected  bool   `json:"is_wifi_connected"`
	CarrierName      string `json:"carrier_name"`
	BlueToothEnable  bool   `json:"blueTooth_enable"`
	Model            string `json:"model"`
	Brand            string `json:"brand"`
	IsEmulator       bool   `json:"is_emulator"`
	OS               string `json:"os"`
	OSVersion        string `json:"os_version"`
	HasNfc           bool   `json:"has_nfc"`
	HasTelephony     bool   `json:"has_telephone"`
	BlueToothVersion string `json:"bluetooth_version"`
	ScreenDPI        int    `json:"screen_dpi"`
	ScreenWidth      int    `json:"screen_width"`
	ScreenHeight     int    `json:"screen_height"`
	//Below fields only need to be sent when it is a new user
	HardwareID string `json:"hardware_id"`

	//TODO we need to discuss if below fields should be sent
	UriScheme string `json:"uri_scheme"`
}
```
For Android, unique_id must be Secure.ANDROID_ID

For IOS, unique_id must be advertisingIdentifier or identifierForVendor

If succeeded, returns HTTP 200 OK code and response:
```json
{
  "inapp_data": "ccc"
}
```

InappData service need to do two things to get the response:

1. If ShortSeg is set, request url generator to extract in-app data, and response to client.

2. If ShortSeg is not set:

	1). If Click ID exist, then set cookieID to clickID
	
	   If Click ID does not exist, Call cookies service: GET /cookies/uniqueID; If response success, set cookieID according to response.
	
	2). Call match service: If succeeded to get cookieID in 1, GET /matches/appID/cookieID; else GET /matches/appID with the following parameters:
	
	`receiver_info={unique_id:receiver_unique_id,hardware_id:required_when_tracking_is_install...other receiver info}
	&tracking=install/open
	&client_ip=ip_of_client
	&client_ua=user_agent_of_client`
	
If both cookieID and uniqueID are not empty, InappData service sends the pair(under the appID) to AppCookieDevice.


