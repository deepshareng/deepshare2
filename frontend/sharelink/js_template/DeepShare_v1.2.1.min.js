function DeepShare(e){var i=this,a={},n=function(n,o){if(n instanceof Array)for(var d=0;d<n.length;d++){var t=n[d];t.app_id=e;var l=new DeepShareWorker(t);l.base=i,l.SetBindInfo(o),a[t.deeplink_id]=l}else{n.app_id=e;var l=new DeepShareWorker(n);l.base=i,l.SetBindInfo(o),a[0]=l}};this._DSCallbacks={weixinIOSTipCallback:null,weixinAndroidTipCallback:null,weiboIOSTipCallback:null,weiboAndroidTipCallback:null,qqIOSTipCallback:null,qqAndroidTipCallback:null,cannotDeeplinkCallback:null,iosLandingCallback:null,androidMarketLandingCallback:null,androidDownloadLandingCallback:null,androidCannotGoMarketLandingCallback:null,iosPlatformNotAvailCallback:null,androidPlatformNotAvailCallback:null},this.BindParams=function(i){if(DeepShare.dsLogDebug("Try bind, inapp_data: "+JSON.stringify(i)),i instanceof Array){for(var a=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+e,o=0;o<i.length;o++)i[o].deeplink_id=""+i[o].deeplink_id;$.ajax({url:a,type:"POST",data:JSON.stringify(i),xhrFields:{withCredentials:!0},success:function(e){n(i,e),DeepShare.dsLogDebug("Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Params Error: "+JSON.stringify(e)+", info: "+i)},dataType:"json"})}else{var a=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+e;$.ajax({url:a,type:"POST",data:JSON.stringify([i]),xhrFields:{withCredentials:!0},success:function(e){n(i,e),DeepShare.dsLogDebug("Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Params Error: "+JSON.stringify(e)+", info: "+i)},dataType:"json"})}},this.Start=function(e){e?(e=""+e,a.hasOwnProperty(e)&&a[e].Start()):a[0].Start()},this.SetCallbackWeixinIOSTip=function(e){this._DSCallbacks.weixinIOSTipCallback=e},this.SetCallbackWeixinAndroidTip=function(e){this._DSCallbacks.weixinAndroidTipCallback=e},this.SetCallbackWeiboIOSTip=function(e){this._DSCallbacks.weiboIOSTipCallback=e},this.SetCallbackWeiboAndroidTip=function(e){this._DSCallbacks.weiboAndroidTipCallback=e},this.SetCallbackQQIOSTip=function(e){this._DSCallbacks.qqIOSTipCallback=e},this.SetCallbackQQAndroidTip=function(e){this._DSCallbacks.qqAndroidTipCallback=e},this.SetCallbackQQAndroidTip=function(e){this._DSCallbacks.qqAndroidTipCallback=e},this.SetCallbackIOSNotAvailable=function(e){this._DSCallbacks.iosPlatformNotAvailCallback=e},this.SetCallbackAndroidNotAvailable=function(e){this._DSCallbacks.androidPlatformNotAvailCallback=e},this.SetCallbackCannotDeeplink=function(e){this._DSCallbacks.cannotDeeplinkCallback=e},this.SetCallbackIOSLanding=function(e){this._DSCallbacks.iosLandingCallback=e},this.SetCallbackAndroidMarketLanding=function(e){this._DSCallbacks.androidMarketLandingCallback=e},this.SetCallbackAndroidDownloadLanding=function(e){this._DSCallbacks.androidDownloadLandingCallback=e},this.SetCallbackAndroidCannotGoMarketLanding=function(e){this._DSCallbacks.androidCannotGoMarketLandingCallback=e}}function DeepShareWorker(e){var i=this,a={INITIAL:0,BINDED:1,DISMISSED:2},n="0",o="",d="",t=a.INITIAL,l={inapp_data:"",sender_id:"",app_id:"",download_title:"",download_msg:"",download_btn_text:"",download_url_ios:"",download_url_android:"",channels:[]},s=null,r={windowLocation:function(e){window.location=e},windowOpen:function(e){window.open(e)},windowClose:function(){window.close()},windowChangeHistory:function(){window.history.replaceState("Object","Title","0")},windowAddEventListener:function(e,i){window.addEventListener(e,i)},windowUrlAddTag:function(){if(window.location.search.indexOf(DS_kDSTag)<0){var e=Math.floor(1e6*Math.random()),i="?"+DS_kDSTag+"="+e;window.location.search=i,DeepShare.dsLogDebug("Url Add Tag:"+i)}},cookieEnabled:function(){var e=!1;try{localStorage.test=2}catch(i){DeepShare.dsLogDebug("private mode"),e=!0}return navigator.cookieEnabled&&!e}},c={trackingUrl:"v2/dsactions/",actionJSDeepLink:"js/deeplink",actionJSDst:"js/dst",actionJSUserClick:"js/userclick",destination:{dstweixintipandroid:"dst-weixin-tip-android",dstweixintipios:"dst-weixin-tip-ios",dstqqtipandroid:"dst-qq-tip-android",dstqqtipios:"dst-qq-tip-ios",dstweibotipandroid:"dst-weibo-tip-android",dstweibotipios:"dst-weibo-tip-ios",dstcannotdeeplink:"dst-cannot-deeplink",dstucbrowser:"dst-uc-browser",dstios9UniversalLinkLandPage:"dst-ios9-universallink-landpage",dstandroidDirectDownloadLandPage:"dst-android-direct-download-landpage",dstandroidMarketLandPage:"dst-android-market-landpage",dstandroidCannotGoMarketLandPage:"dst-android-cannot-gomarket-landpage",dstplatformNA:"dst-{Platform}-not-available"}},u=function(e){IsNullOrUndefined(e.app_id)||(l.app_id=e.app_id),IsNullOrUndefined(e.inapp_data)||(l.inapp_data=e.inapp_data),IsNullOrUndefined(e.sender_id)||(l.sender_id=e.sender_id),IsNullOrUndefined(e.download_title)||(l.download_title=e.download_title),IsNullOrUndefined(e.download_msg)||(l.download_msg=e.download_msg),IsNullOrUndefined(e.download_btn_text)||(l.download_btn_text=e.download_btn_text),IsNullOrUndefined(e.download_url_ios)||(l.download_url_ios=e.download_url_ios),IsNullOrUndefined(e.download_url_android)||(l.download_url_android=e.download_url_android),IsNullOrUndefined(e.channels)||(l.channels=e.channels),IsNullOrUndefined(e.callbacks)||(i.base._DSCallbacks=e.callbacks),IsNullOrUndefined(e.deeplink_id)||(n=""+e.deeplink_id)},b=function(e){if(DeepShare.dsLogDebug("Try refresh bind, force: "+e+", binded: "+t+", deeplink_id: "+n+", match_id: "+s.match_id),e||t!==a.BINDED){var i=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+l.app_id+"?clicked=true";$.ajax({url:i,type:"POST",data:JSON.stringify({deeplink_id:n,match_id:s.match_id,sender_id:l.sender_id,channels:l.channels,inapp_data:l.inapp_data}),xhrFields:{withCredentials:!0},success:function(e){DeepShare.dsLogDebug("Refresh result: "+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Bind Error: "+JSON.stringify(e)+", info: "+i)},dataType:"json"})}},p=function(e,i){var a={action:e,kvs:{click_id:s.match_id,destination:i,ds_tag:s.ds_tag}},n=DS_kRequestProtocol+DS_kServerName+c.trackingUrl+s.app_id,o=JSON.stringify(a);$.post(n,o,function(e){}).error(function(){})},D=function(e){r.windowAddEventListener("pagehide",function(){DeepShare.dsLogDebug("window event pagehide"),clearTimeout(e)}),r.windowAddEventListener("blur",function(){DeepShare.dsLogDebug("window event blur"),clearTimeout(e)}),r.windowAddEventListener("unload",function(){DeepShare.dsLogDebug("window event unload"),clearTimeout(e)}),document.addEventListener("webkitvisibilitychange",function(){DeepShare.dsLogDebug("window event webkitvisibilitychange"),document.webkitHidden&&(DeepShare.dsLogDebug("window is hidden"),clearTimeout(e))}),r.windowAddEventListener("beforeunload",function(){DeepShare.dsLogDebug("window event beforeunload"),clearTimeout(e)}),r.windowAddEventListener("focus",function(){DeepShare.dsLogDebug("window event focus")}),r.windowAddEventListener("focusout",function(){DeepShare.dsLogDebug("Window event focusout"),clearTimeout(e)})};_gotoTip=function(e,a){if(DeepShare.dsLogDebug("Go to tip: "+a),"ios"===e)switch(a){case c.destination.dstweixintipios:IsNullOrUndefined(i.base._DSCallbacks.weixinIOSTipCallback)?DeepShare.dsLogDebug("weixin ios tip"):i.base._DSCallbacks.weixinIOSTipCallback();break;case c.destination.dstweibotipios:IsNullOrUndefined(i.base._DSCallbacks.weiboIOSTipCallback)?DeepShare.dsLogDebug("weibo ios tip"):i.base._DSCallbacks.weiboIOSTipCallback();break;case c.destination.dstqqtipios:IsNullOrUndefined(i.base._DSCallbacks.qqIOSTipCallback)?DeepShare.dsLogDebug("qq ios tip"):i.base._DSCallbacks.qqIOSTipCallback()}else if("android"===e)switch(a){case c.destination.dstweixintipandroid:IsNullOrUndefined(i.base._DSCallbacks.weixinAndroidTipCallback)?DeepShare.dsLogDebug("weixin android tip"):i.base._DSCallbacks.weixinAndroidTipCallback();break;case c.destination.dstweibotipandroid:IsNullOrUndefined(i.base._DSCallbacks.weiboAndroidTipCallback)?DeepShare.dsLogDebug("weibo android tip"):i.base._DSCallbacks.weiboAndroidTipCallback();break;case c.destination.dstqqtipandroid:IsNullOrUndefined(i.base._DSCallbacks.qqAndroidTipCallback)?DeepShare.dsLogDebug("qq android tip"):i.base._DSCallbacks.qqAndroidTipCallback()}d=a,p(c.actionJSDst,d)};var S=function(){DeepShare.dsLogDebug("cannot deeplink"),IsNullOrUndefined(i.base._DSCallbacks.cannotDeeplinkCallback)?DeepShare.dsLogDebug("cannot deeplink"):i.base._DSCallbacks.cannotDeeplinkCallback(),d=c.destination.dstcannotdeeplink,p(c.actionJSDst,d)},g=function(){DeepShare.dsLogDebug("Go to android new install"),s.is_download_directly?h():s.cannot_go_market?_():s.cannot_get_win_event||s.is_uc?k():f()},k=function(){d=c.destination.dstandroidMarketLandPage,DeepShare.dsLogDebug("Go to android market landing page: "+d),IsNullOrUndefined(i.base._DSCallbacks.androidMarketLandingCallback)?DeepShare.dsLogDebug("android market"):i.base._DSCallbacks.androidMarketLandingCallback(),p(c.actionJSDst,d)},_=function(){d=c.destination.dstandroidCannotGoMarketLandPage,DeepShare.dsLogDebug("Go to android can not go to market landing page: "+d),IsNullOrUndefined(i.base._DSCallbacks.androidCannotGoMarketLandingCallback)?DeepShare.dsLogDebug("android cannot go market"):i.base._DSCallbacks.androidCannotGoMarketLandingCallback(),p(c.actionJSDst,d)},h=function(){d=c.destination.dstandroidDirectDownloadLandPage,DeepShare.dsLogDebug("Go to android download landing page: "+d),IsNullOrUndefined(i.base._DSCallbacks.androidDownloadLandingCallback)?(DeepShare.dsLogDebug("android downloading..."),w(s.url)):i.base._DSCallbacks.androidDownloadLandingCallback(),p(c.actionJSDst,d)},f=function(){d="market://details?id="+s.pkg,DeepShare.dsLogDebug("Go to android market: "+d),p(c.actionJSDst,d),r.windowLocation(d)},w=function(e){DeepShare.dsLogDebug("Goto url: "+e),b(!0),d=e,p(c.actionJSDst,e),r.windowLocation(e)},C=function(e){"ios"===e?IsNullOrUndefined(i.base._DSCallbacks.iosPlatformNotAvailCallback)?DeepShare.dsLogDebug("ios platform not available"):i.base._DSCallbacks.iosPlatformNotAvailCallback():"android"===e&&(IsNullOrUndefined(i.base._DSCallbacks.androidPlatformNotAvailCallback)?DeepShare.dsLogDebug("android platform not available"):i.base._DSCallbacks.androidPlatformNotAvailCallback()),d=c.destination.dstplatformNA.replace(/{Platform}/g,e),p(c.actionJSDst,d)},L=function(e,i,a){o=e,DeepShare.dsLogDebug("deeplinklaunch: "+o),p(c.actionJSDeepLink,e),r.windowLocation(e);var n=setTimeout(function(){a()},i);D(n)},m=function(e,i){o=e;var a=null;try{p(c.actionJSDeepLink,e),a=r.windowOpen(e),DeepShare.dsLogDebug("chrome ios open pass")}catch(n){DeepShare.dsLogDebug("chrome ios open exception")}a?r.windowClose():i()},I=function(e,i,a){DeepShare.dsLogDebug("Go to iframeDeeplinkLaunch: "+e);var n=setTimeout(function(){a()},i);D(n);var d=document.createElement("iframe");d.style.width="1px",d.style.height="1px",d.border="none",d.style.display="none",d.src=e,document.body.appendChild(d),o=e,p(c.actionJSDeepLink,e)},v=function(){return s.is_ios&&(void 0===s.bundle_id||""===s.bundle_id)},O=function(){return s.is_android&&(void 0===s.pkg||""===s.pkg)},N=function(){return void 0!==s.yyb_url&&""!==s.yyb_url},T=function(e,i,a){DeepShare.dsLogDebug("Deal with iOS: "+e+" dst: "+i+" url: "+a),s.ios_major<=8?IsNullOrUndefined(a)?_gotoTip(e,i):w(a):s.is_universal_link?w(s.ds_url||s.ds_urls[n]||""):_gotoTip(e,i)};this._Start=function(){var e=this;e._Start()},this.Start=function(){p("ds_jssdk_click","");var e="";if(v())return void C("ios");if(O())return void C("android");if(s.is_wechat)DeepShare.dsLogDebug("In WeChat"),N()?(DeepShare.dsLogDebug("YYBurl is: "+s.yyb_url),s.is_ios?T("ios",c.destination.dstweixintipios,s.yyb_url):w(s.yyb_url)):s.is_ios?(DeepShare.dsLogDebug("isIOS without YYBurl"),T("ios",c.destination.dstweixintipios)):s.is_android&&(DeepShare.dsLogDebug("isAndroid without YYBurl"),_gotoTip("android",c.destination.dstweixintipandroid));else if(s.is_qq)DeepShare.dsLogDebug("In QQ"),N()?(DeepShare.dsLogDebug("YYBurl is: "+s.yyb_url),s.is_ios?T("ios",c.destination.dstqqtipios,s.yyb_url):w(s.yyb_url)):s.is_ios?(DeepShare.dsLogDebug("isIOS"),T("ios",c.destination.dstqqtipios)):s.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",c.destination.dstqqtipandroid));else if(s.is_weibo)DeepShare.dsLogDebug("In Weibo"),s.is_ios?(DeepShare.dsLogDebug("isIOS"),T("ios",c.destination.dstweibotipios)):s.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",c.destination.dstweibotipandroid));else if(s.is_ios)DeepShare.dsLogDebug("In iOS"),e=s.scheme+"://",s.match_id&&s.match_id.length>0&&(e+="?click_id="+s.match_id,e+="&deeplink_id="+n),DeepShare.dsLogDebug("Deeplink url: "+e),s.ios_major<9?(DeepShare.dsLogDebug("IOS Major below 9:"+s.ios_major),I(e,2e3,function(){w(s.url)})):(DeepShare.dsLogDebug("IOS Major upper 9:"+s.ios_major),s.chrome_major>0?(DeepShare.dsLogDebug("isChrome"),m(e,function(){w(s.url)})):s.is_universal_link?(DeepShare.dsLogDebug("isUniversallink = true"),w(s.ds_url||s.ds_urls[n]||"")):(DeepShare.dsLogDebug("is safari"),L(e,500,function(){w(s.url)})));else if(s.is_android)if(DeepShare.dsLogDebug("In Android"),e=s.scheme+"://"+s.host,s.match_id&&s.match_id.length>0&&(e+="?click_id="+s.match_id,e+="&deeplink_id="+n),DeepShare.dsLogDebug("Deeplink url: "+e),s.cannot_deeplink)I(e,2e3,function(){S()});else if(s.is_qq_browser)DeepShare.dsLogDebug("In QQ browser"),N()?(DeepShare.dsLogDebug(s.yyb_url),w(s.yyb_url)):S();else if(s.is_uc)DeepShare.dsLogDebug("In UC browser"),I(e,5e3,function(){g()});else if(s.chrome_major>=25&&!s.force_use_scheme){DeepShare.dsLogDebug("In chrome major >= 25, Chrome_major:"+s.chrome_major);var i=s.host;s.match_id&&s.match_id.length>0&&(i+="?click_id="+s.match_id,i+="&deeplink_id="+n);var o=s.pkg,d="intent://"+i+"#Intent;scheme="+toLowerCase(s.scheme)+";package="+o+";S.browser_fallback_url="+s.url+";end";L(d,2e3,function(){g()})}else DeepShare.dsLogDebug("In default browser"),I(e,2e3,function(){g()});t=a.DISMISSED},this.SetBindInfo=function(e){s=e},u(e)}function IsNullOrEmpty(e){return!(e&&e.length>0)}function IsNullOrUndefined(e){return"undefined"==typeof e||null===e}function toLowerCase(e){return"string"==typeof e?e.toLowerCase():"undefined"==typeof object||null===object?"":(e=""+e,e.toLowerCase())}DeepShare.dsLogDebug=function(e){if(DeepShare.DEBUG){var i=new Date;ws.readyState===ws.OPEN&&ws.send("[DEBUG] - ["+i.toLocaleTimeString()+"] - "+e)}},DeepShare.VERSION="1.2.1",DeepShare.DEBUG=!1,DS_kPostVerb="POST",DS_kRequestProtocol="https://",DS_kServerName="fds.so/",DS_kVersionName="v2/",DS_kAPIJS="jsapi/",DS_kDSTag="ds_tag";