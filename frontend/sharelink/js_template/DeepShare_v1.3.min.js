function DeepShare(e){var i=this,a={},n=function(n,o){if(n instanceof Array)for(var d=0;d<n.length;d++){var t=n[d];t.app_id=e;var s=new DeepShareWorker(t);s.base=i,s.SetBindInfo(o),a[t.deeplink_id]=s}else{n.app_id=e;var s=new DeepShareWorker(n);s.base=i,s.SetBindInfo(o),a[0]=s}};this._DSCallbacks={weixinIOSTipCallback:null,weixinAndroidTipCallback:null,weiboIOSTipCallback:null,weiboAndroidTipCallback:null,qqIOSTipCallback:null,qqAndroidTipCallback:null,cannotDeeplinkCallback:null,iosLandingCallback:null,androidMarketLandingCallback:null,androidDownloadLandingCallback:null,androidCannotGoMarketLandingCallback:null,iosPlatformNotAvailCallback:null,androidPlatformNotAvailCallback:null},this.BindParams=function(i){DeepShare.dsLogDebug("Try bind, inapp_data: "+JSON.stringify(i));var a=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+e;if(i instanceof Array){for(var o=0;o<i.length;o++)i[o].deeplink_id=""+i[o].deeplink_id;$.ajax({url:a,type:"POST",data:JSON.stringify(i),xhrFields:{withCredentials:!0},success:function(e){n(i,e),DeepShare.dsLogDebug("Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Params Error: "+JSON.stringify(e)+", info: "+i)},dataType:"json"})}else i.deeplink_id=""+i.deeplink_id,$.ajax({url:a,type:"POST",data:JSON.stringify([i]),xhrFields:{withCredentials:!0},success:function(e){n(i,e),DeepShare.dsLogDebug("Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Params Error: "+JSON.stringify(e)+", info: "+i)},dataType:"json"})},this.Start=function(e){e?(e=""+e,a.hasOwnProperty(e)&&a[e].Start()):a[0].Start()},this.SetCallbackWeixinIOSTip=function(e){this._DSCallbacks.weixinIOSTipCallback=e},this.SetCallbackWeixinAndroidTip=function(e){this._DSCallbacks.weixinAndroidTipCallback=e},this.SetCallbackWeiboIOSTip=function(e){this._DSCallbacks.weiboIOSTipCallback=e},this.SetCallbackWeiboAndroidTip=function(e){this._DSCallbacks.weiboAndroidTipCallback=e},this.SetCallbackQQIOSTip=function(e){this._DSCallbacks.qqIOSTipCallback=e},this.SetCallbackQQAndroidTip=function(e){this._DSCallbacks.qqAndroidTipCallback=e},this.SetCallbackIOSNotAvailable=function(e){this._DSCallbacks.iosPlatformNotAvailCallback=e},this.SetCallbackAndroidNotAvailable=function(e){this._DSCallbacks.androidPlatformNotAvailCallback=e},this.SetCallbackCannotDeeplink=function(e){this._DSCallbacks.cannotDeeplinkCallback=e},this.SetCallbackIOSLanding=function(e){this._DSCallbacks.iosLandingCallback=e},this.SetCallbackAndroidMarketLanding=function(e){this._DSCallbacks.androidMarketLandingCallback=e},this.SetCallbackAndroidDownloadLanding=function(e){this._DSCallbacks.androidDownloadLandingCallback=e},this.SetCallbackAndroidCannotGoMarketLanding=function(e){this._DSCallbacks.androidCannotGoMarketLandingCallback=e}}function DeepShareWorker(e){var i=this,a={INITIAL:0,BINDED:1,DISMISSED:2},n="0",o="",d="",t=a.INITIAL,s={inapp_data:"",sender_id:"",app_id:"",download_title:"",download_msg:"",download_btn_text:"",download_url_ios:"",download_url_android:"",channels:[]},l=null,r={windowLocation:function(e){window.location=e},windowOpen:function(e){window.open(e)},windowClose:function(){window.close()},windowChangeHistory:function(){window.history.replaceState("Object","Title","0")},windowAddEventListener:function(e,i){window.addEventListener(e,i)},windowUrlAddTag:function(){if(window.location.search.indexOf(DS_kDSTag)<0){var e=Math.floor(1e6*Math.random()),i="?"+DS_kDSTag+"="+e;window.location.search=i,DeepShare.dsLogDebug("Url Add Tag:"+i)}},cookieEnabled:function(){var e=!1;try{localStorage.test=2}catch(i){DeepShare.dsLogDebug("private mode"),e=!0}return navigator.cookieEnabled&&!e}},c={trackingUrl:"v2/dsactions/",actionJSDeepLink:"js/deeplink",actionJSDst:"js/dst",actionJSUserClick:"js/userclick",destination:{dstweixintipandroid:"dst-weixin-tip-android",dstweixintipios:"dst-weixin-tip-ios",dstqqtipandroid:"dst-qq-tip-android",dstqqtipios:"dst-qq-tip-ios",dstweibotipandroid:"dst-weibo-tip-android",dstweibotipios:"dst-weibo-tip-ios",dstcannotdeeplink:"dst-cannot-deeplink",dstucbrowser:"dst-uc-browser",dstios9UniversalLinkLandPage:"dst-ios9-universallink-landpage",dstandroidDirectDownloadLandPage:"dst-android-direct-download-landpage",dstandroidMarketLandPage:"dst-android-market-landpage",dstandroidCannotGoMarketLandPage:"dst-android-cannot-gomarket-landpage",dstplatformNA:"dst-{Platform}-not-available"}},u=function(e){IsNullOrUndefined(e.app_id)||(s.app_id=e.app_id),IsNullOrUndefined(e.inapp_data)||(s.inapp_data=e.inapp_data),IsNullOrUndefined(e.sender_id)||(s.sender_id=e.sender_id),IsNullOrUndefined(e.download_title)||(s.download_title=e.download_title),IsNullOrUndefined(e.download_msg)||(s.download_msg=e.download_msg),IsNullOrUndefined(e.download_btn_text)||(s.download_btn_text=e.download_btn_text),IsNullOrUndefined(e.download_url_ios)||(s.download_url_ios=e.download_url_ios),IsNullOrUndefined(e.download_url_android)||(s.download_url_android=e.download_url_android),IsNullOrUndefined(e.channels)||(s.channels=e.channels),IsNullOrUndefined(e.callbacks)||(i.base._DSCallbacks=e.callbacks),IsNullOrUndefined(e.deeplink_id)||(n=""+e.deeplink_id)},b=function(e){if(DeepShare.dsLogDebug("Try refresh bind, force: "+e+", binded: "+t+", deeplink_id: "+n+", match_id: "+l.match_id),e||t!==a.BINDED){var i=DS_kRequestProtocol+DS_kServerName+DS_kVersionName+DS_kAPIJS+s.app_id+"?clicked=true";$.ajax({url:i,type:"POST",data:JSON.stringify({deeplink_id:n,match_id:l.match_id,sender_id:s.sender_id,channels:s.channels,inapp_data:s.inapp_data}),xhrFields:{withCredentials:!0},success:function(e){DeepShare.dsLogDebug("Refresh result: "+JSON.stringify(e))},error:function(e,i){DeepShare.dsLogDebug("Refresh Bind Error: "+JSON.stringify(e)+", info: "+i)},dataType:"json"})}},p=function(e,i){var a={action:e,kvs:{click_id:l.match_id,destination:i,ds_tag:l.ds_tag}},n=DS_kRequestProtocol+DS_kServerName+c.trackingUrl+l.app_id,o=JSON.stringify(a);$.post(n,o,function(e){}).error(function(){})},D=function(e){r.windowAddEventListener("pagehide",function(){DeepShare.dsLogDebug("window event pagehide"),clearTimeout(e)}),r.windowAddEventListener("blur",function(){DeepShare.dsLogDebug("window event blur"),clearTimeout(e)}),r.windowAddEventListener("unload",function(){DeepShare.dsLogDebug("window event unload"),clearTimeout(e)}),document.addEventListener("webkitvisibilitychange",function(){DeepShare.dsLogDebug("window event webkitvisibilitychange"),document.webkitHidden&&(DeepShare.dsLogDebug("window is hidden"),clearTimeout(e))}),r.windowAddEventListener("beforeunload",function(){DeepShare.dsLogDebug("window event beforeunload"),clearTimeout(e)}),r.windowAddEventListener("focus",function(){DeepShare.dsLogDebug("window event focus")}),r.windowAddEventListener("focusout",function(){DeepShare.dsLogDebug("Window event focusout"),clearTimeout(e)})};_gotoTip=function(e,a){if(DeepShare.dsLogDebug("Go to tip: "+a),"ios"===e)switch(a){case c.destination.dstweixintipios:IsNullOrUndefined(i.base._DSCallbacks.weixinIOSTipCallback)?(DeepShare.dsLogDebug("weixin ios tip"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.weixinIOSTipCallback();break;case c.destination.dstweibotipios:IsNullOrUndefined(i.base._DSCallbacks.weiboIOSTipCallback)?(DeepShare.dsLogDebug("weibo ios tip"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.weiboIOSTipCallback();break;case c.destination.dstqqtipios:IsNullOrUndefined(i.base._DSCallbacks.qqIOSTipCallback)?(DeepShare.dsLogDebug("qq ios tip"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.qqIOSTipCallback()}else if("android"===e)switch(a){case c.destination.dstweixintipandroid:IsNullOrUndefined(i.base._DSCallbacks.weixinAndroidTipCallback)?(DeepShare.dsLogDebug("weixin android tip"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.weixinAndroidTipCallback();break;case c.destination.dstweibotipandroid:IsNullOrUndefined(i.base._DSCallbacks.weiboAndroidTipCallback)?(DeepShare.dsLogDebug("weibo android tip"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.weiboAndroidTipCallback();break;case c.destination.dstqqtipandroid:IsNullOrUndefined(i.base._DSCallbacks.qqAndroidTipCallback)?(DeepShare.dsLogDebug("qq android tip"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.qqAndroidTipCallback()}d=a,p(c.actionJSDst,d)};var _=function(){DeepShare.dsLogDebug("cannot deeplink"),IsNullOrUndefined(i.base._DSCallbacks.cannotDeeplinkCallback)?(DeepShare.dsLogDebug("cannot deeplink"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.cannotDeeplinkCallback(),d=c.destination.dstcannotdeeplink,p(c.actionJSDst,d)},g=function(){DeepShare.dsLogDebug("Go to android new install"),l.is_download_directly?h():l.cannot_go_market?k():l.cannot_get_win_event||l.is_uc?S():f()},S=function(){d=c.destination.dstandroidMarketLandPage,DeepShare.dsLogDebug("Go to android market landing page: "+d),IsNullOrUndefined(i.base._DSCallbacks.androidMarketLandingCallback)?(DeepShare.dsLogDebug("android market"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.androidMarketLandingCallback(),p(c.actionJSDst,d)},k=function(){d=c.destination.dstandroidCannotGoMarketLandPage,DeepShare.dsLogDebug("Go to android can not go to market landing page: "+d),IsNullOrUndefined(i.base._DSCallbacks.androidCannotGoMarketLandingCallback)?(DeepShare.dsLogDebug("android cannot go market"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.androidCannotGoMarketLandingCallback(),p(c.actionJSDst,d)},h=function(){d=c.destination.dstandroidDirectDownloadLandPage,DeepShare.dsLogDebug("Go to android download landing page: "+d),IsNullOrUndefined(i.base._DSCallbacks.androidDownloadLandingCallback)?(DeepShare.dsLogDebug("android downloading..."),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.androidDownloadLandingCallback(),p(c.actionJSDst,d)},f=function(){d="market://details?id="+l.pkg,DeepShare.dsLogDebug("Go to android market: "+d),p(c.actionJSDst,d),r.windowLocation(d)},w=function(e){DeepShare.dsLogDebug("Goto url: "+e),b(!0),d=e,p(c.actionJSDst,e),r.windowLocation(e)},C=function(e){"ios"===e?IsNullOrUndefined(i.base._DSCallbacks.iosPlatformNotAvailCallback)?(DeepShare.dsLogDebug("ios platform not available"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.iosPlatformNotAvailCallback():"android"===e&&(IsNullOrUndefined(i.base._DSCallbacks.androidPlatformNotAvailCallback)?(DeepShare.dsLogDebug("android platform not available"),w(l.ds_url||l.ds_urls[n]||"")):i.base._DSCallbacks.androidPlatformNotAvailCallback()),d=c.destination.dstplatformNA.replace(/{Platform}/g,e),p(c.actionJSDst,d)},L=function(e,i,a){o=e,DeepShare.dsLogDebug("deeplinklaunch: "+o),p(c.actionJSDeepLink,e),r.windowLocation(e);var n=setTimeout(function(){a()},i);D(n)},m=function(e,i){o=e;var a=null;try{p(c.actionJSDeepLink,e),a=r.windowOpen(e),DeepShare.dsLogDebug("chrome ios open pass")}catch(n){DeepShare.dsLogDebug("chrome ios open exception")}a?r.windowClose():i()},I=function(e,i,a){DeepShare.dsLogDebug("Go to iframeDeeplinkLaunch: "+e);var n=setTimeout(function(){a()},i);D(n);var d=document.createElement("iframe");d.style.width="1px",d.style.height="1px",d.border="none",d.style.display="none",d.src=e,document.body.appendChild(d),o=e,p(c.actionJSDeepLink,e)},O=function(){return l.is_ios&&(void 0===l.bundle_id||""===l.bundle_id)},v=function(){return l.is_android&&(void 0===l.pkg||""===l.pkg)},N=function(){return void 0!==l.yyb_url&&""!==l.yyb_url},T=function(e,i,a){DeepShare.dsLogDebug("Deal with iOS: "+e+" dst: "+i+" url: "+a),l.ios_major<=8?IsNullOrUndefined(a)?_gotoTip(e,i):w(a):l.is_universal_link?w(l.ds_url||l.ds_urls[n]||""):_gotoTip(e,i)};this._Start=function(){var e=this;e._Start()},this.Start=function(){p("ds_jssdk_click","");var e="";if(O())return void C("ios");if(v())return void C("android");if(l.is_wechat)DeepShare.dsLogDebug("In WeChat"),N()?(DeepShare.dsLogDebug("YYBurl is: "+l.yyb_url),l.is_ios?T("ios",c.destination.dstweixintipios,l.yyb_url):w(l.yyb_url)):l.is_ios?(DeepShare.dsLogDebug("isIOS without YYBurl"),T("ios",c.destination.dstweixintipios)):l.is_android&&(DeepShare.dsLogDebug("isAndroid without YYBurl"),_gotoTip("android",c.destination.dstweixintipandroid));else if(l.is_qq)DeepShare.dsLogDebug("In QQ"),N()?(DeepShare.dsLogDebug("YYBurl is: "+l.yyb_url),l.is_ios?T("ios",c.destination.dstqqtipios,l.yyb_url):w(l.yyb_url)):l.is_ios?(DeepShare.dsLogDebug("isIOS"),T("ios",c.destination.dstqqtipios)):l.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",c.destination.dstqqtipandroid));else if(l.is_weibo)DeepShare.dsLogDebug("In Weibo"),l.is_ios?(DeepShare.dsLogDebug("isIOS"),T("ios",c.destination.dstweibotipios)):l.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",c.destination.dstweibotipandroid));else if(l.is_ios)DeepShare.dsLogDebug("In iOS"),e=l.scheme+"://",l.match_id&&l.match_id.length>0&&(e+="?click_id="+l.match_id,e+="&deeplink_id="+n),DeepShare.dsLogDebug("Deeplink url: "+e),l.ios_major<9?(DeepShare.dsLogDebug("IOS Major below 9:"+l.ios_major),I(e,2e3,function(){w(l.url)})):(DeepShare.dsLogDebug("IOS Major upper 9:"+l.ios_major),l.chrome_major>0?(DeepShare.dsLogDebug("isChrome"),m(e,function(){w(l.url)})):l.is_universal_link?(DeepShare.dsLogDebug("isUniversallink = true"),w(l.ds_url||l.ds_urls[n]||"")):(DeepShare.dsLogDebug("is safari"),L(e,500,function(){w(l.url)})));else if(l.is_android)if(DeepShare.dsLogDebug("In Android"),e=l.scheme+"://"+l.host,l.match_id&&l.match_id.length>0&&(e+="?click_id="+l.match_id,e+="&deeplink_id="+n),DeepShare.dsLogDebug("Deeplink url: "+e),l.cannot_deeplink)I(e,2e3,function(){_()});else if(l.is_qq_browser)DeepShare.dsLogDebug("In QQ browser"),N()?(DeepShare.dsLogDebug(l.yyb_url),w(l.yyb_url)):_();else if(l.is_uc)DeepShare.dsLogDebug("In UC browser"),I(e,5e3,function(){g()});else if(l.chrome_major>=25&&!l.force_use_scheme){DeepShare.dsLogDebug("In chrome major >= 25, Chrome_major:"+l.chrome_major);var i=l.host;l.match_id&&l.match_id.length>0&&(i+="?click_id="+l.match_id,i+="&deeplink_id="+n);var o=l.pkg,d="intent://"+i+"#Intent;scheme="+toLowerCase(l.scheme)+";package="+o+";S.browser_fallback_url="+l.url+";end";L(d,2e3,function(){g()})}else DeepShare.dsLogDebug("In default browser"),I(e,2e3,function(){g()});t=a.DISMISSED},this.SetBindInfo=function(e){l=e},u(e)}function IsNullOrEmpty(e){return!(e&&e.length>0)}function IsNullOrUndefined(e){return"undefined"==typeof e||null===e}function toLowerCase(e){return"string"==typeof e?e.toLowerCase():"undefined"==typeof object||null===object?"":(e=""+e,e.toLowerCase())}DeepShare.dsLogDebug=function(e){if(DeepShare.DEBUG){var i=new Date;ws.readyState===ws.OPEN&&ws.send("[DEBUG] - ["+i.toLocaleTimeString()+"] - "+e)}},DeepShare.VERSION="1.3",DeepShare.DEBUG=!1,DS_kPostVerb="POST",DS_kRequestProtocol="https://",DS_kServerName="fds.so/",DS_kVersionName="v2/",DS_kAPIJS="jsapi/",DS_kDSTag="ds_tag";